# Production values for orochi-cloud
# Override default values with production-specific settings

# Global production settings
global:
  imagePullSecrets:
    - name: ghcr-credentials
  storageClass: "fast-ssd"
  nodeSelector:
    node-type: orochi-cloud

# Control Plane API - Production
controlPlane:
  replicaCount: 3

  image:
    pullPolicy: Always

  resources:
    limits:
      cpu: "4"
      memory: 4Gi
    requests:
      cpu: "1"
      memory: 1Gi

  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 20
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  podDisruptionBudget:
    enabled: true
    minAvailable: 2

  config:
    logLevel: info
    logFormat: json
    dbPoolSize: 50
    jwtExpiration: 8
    rateLimit: 5000

  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/component
                  operator: In
                  values:
                    - control-plane
            topologyKey: kubernetes.io/hostname
        - weight: 50
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/component
                  operator: In
                  values:
                    - control-plane
            topologyKey: topology.kubernetes.io/zone

  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9090"
    prometheus.io/path: "/metrics"

# Dashboard - Production
dashboard:
  replicaCount: 3

  image:
    pullPolicy: Always

  resources:
    limits:
      cpu: "2"
      memory: 2Gi
    requests:
      cpu: "500m"
      memory: 512Mi

  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 15
    targetCPUUtilizationPercentage: 70

  podDisruptionBudget:
    enabled: true
    minAvailable: 2

  ingress:
    enabled: true
    className: nginx
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/proxy-body-size: "50m"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
      nginx.ingress.kubernetes.io/rate-limit: "100"
      nginx.ingress.kubernetes.io/rate-limit-window: "1m"
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/configuration-snippet: |
        more_set_headers "X-Frame-Options: DENY";
        more_set_headers "X-Content-Type-Options: nosniff";
        more_set_headers "X-XSS-Protection: 1; mode=block";
        more_set_headers "Referrer-Policy: strict-origin-when-cross-origin";
        more_set_headers "Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';";
    hosts:
      - host: console.orochi-cloud.io
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: dashboard-tls-prod
        hosts:
          - console.orochi-cloud.io

  config:
    nodeEnv: production
    publicApiUrl: "https://api.orochi-cloud.io"

  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/component
                  operator: In
                  values:
                    - dashboard
            topologyKey: kubernetes.io/hostname

  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9090"
    prometheus.io/path: "/metrics"

# Autoscaler - Production
autoscaler:
  replicaCount: 2

  image:
    pullPolicy: Always

  resources:
    limits:
      cpu: "2"
      memory: 1Gi
    requests:
      cpu: "500m"
      memory: 512Mi

  config:
    metricsInterval: 15
    scaleUpCooldown: 180
    scaleDownCooldown: 300
    cpuScaleUpThreshold: 75
    cpuScaleDownThreshold: 25
    memoryScaleUpThreshold: 80
    connectionScaleUpThreshold: 75
    minInstances: 2
    maxInstances: 50

  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/component
                operator: In
                values:
                  - autoscaler
          topologyKey: kubernetes.io/hostname

  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9090"
    prometheus.io/path: "/metrics"

# Provisioner - Production
provisioner:
  replicaCount: 2

  image:
    pullPolicy: Always

  resources:
    limits:
      cpu: "2"
      memory: 1Gi
    requests:
      cpu: "500m"
      memory: 512Mi

  config:
    reconcileInterval: 30
    defaultStorageClass: "fast-ssd"
    backupStorageClass: "standard"
    maxConcurrentProvisions: 10
    provisionTimeout: 45

  cloudProvider:
    type: aws
    aws:
      region: us-east-1

  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/component
                operator: In
                values:
                  - provisioner
          topologyKey: kubernetes.io/hostname

  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9090"
    prometheus.io/path: "/metrics"

# Network Policies - Production
networkPolicy:
  enabled: true
  ingressNamespaces:
    - ingress-nginx
    - monitoring
    - istio-system

# Monitoring - Production
monitoring:
  serviceMonitor:
    enabled: true
    namespace: monitoring
    interval: 15s
    scrapeTimeout: 10s
    labels:
      release: prometheus

  grafanaDashboards:
    enabled: true
    labels:
      grafana_dashboard: "1"

# Storage Configuration - Production
storage:
  createStorageClasses: true
  createDefaultClass: true

  # Use DigitalOcean for production (or change to aws/gcp/azure)
  provider: digitalocean

  # Hot Tier - Production settings
  hotTier:
    name: orochi-hot-tier
    volumeBindingMode: Immediate
    reclaimPolicy: Delete
    allowVolumeExpansion: true

    parameters:
      type: "ext4"

    mountOptions:
      - noatime
      - nodiratime
      - discard
      - barrier=0

    annotations:
      orochi.db/recommended-min-size: "200Gi"
      orochi.db/production: "true"
      orochi.db/iops-per-gb: "40"
      orochi.db/max-iops: "7500"
      digitalocean.com/storage-tier: "hot"

  # Warm Tier - Production settings
  warmTier:
    name: orochi-warm-tier
    volumeBindingMode: WaitForFirstConsumer
    reclaimPolicy: Retain
    allowVolumeExpansion: true

    parameters:
      type: "ext4"

    mountOptions:
      - noatime
      - nodiratime
      - discard

    annotations:
      orochi.db/recommended-min-size: "100Gi"
      orochi.db/production: "true"
      digitalocean.com/storage-tier: "warm"

  # Cold Tier - Production settings
  coldTier:
    name: orochi-cold-tier
    volumeBindingMode: WaitForFirstConsumer
    reclaimPolicy: Retain
    allowVolumeExpansion: true

    parameters:
      type: "ext4"

    mountOptions:
      - noatime
      - nodiratime
      - discard
      - data=writeback

    annotations:
      orochi.db/recommended-min-size: "500Gi"
      orochi.db/production: "true"
      orochi.db/use-case: "backups,archives,wal"
      digitalocean.com/storage-tier: "cold"

  # Default StorageClass - Production settings
  defaultClass:
    name: orochi-default
    volumeBindingMode: WaitForFirstConsumer
    reclaimPolicy: Delete
    allowVolumeExpansion: true

    parameters:
      type: "ext4"

    mountOptions:
      - noatime
      - nodiratime
      - discard

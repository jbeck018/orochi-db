{{- if .Values.controlPlane.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "orochi-cloud.controlPlane.fullname" . }}-secret
  namespace: {{ include "orochi-cloud.namespace" . }}
  labels:
    {{- include "orochi-cloud.controlPlane.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.controlPlane.secrets.databaseUrl }}
  DATABASE_URL: {{ .Values.controlPlane.secrets.databaseUrl | b64enc | quote }}
  {{- else }}
  # Placeholder - override with external secret management in production
  DATABASE_URL: {{ "postgresql://postgres:postgres@localhost:5432/orochi_cloud" | b64enc | quote }}
  {{- end }}
  {{- if .Values.controlPlane.secrets.jwtSecret }}
  JWT_SECRET: {{ .Values.controlPlane.secrets.jwtSecret | b64enc | quote }}
  {{- else }}
  # Placeholder - generate a secure secret in production
  JWT_SECRET: {{ "change-me-in-production-with-a-secure-random-string" | b64enc | quote }}
  {{- end }}
  {{- if .Values.controlPlane.secrets.encryptionKey }}
  ENCRYPTION_KEY: {{ .Values.controlPlane.secrets.encryptionKey | b64enc | quote }}
  {{- else }}
  # Placeholder - generate a secure encryption key in production
  ENCRYPTION_KEY: {{ "change-me-32-byte-encryption-key!" | b64enc | quote }}
  {{- end }}
---
# External Secret Template (for use with External Secrets Operator)
# Uncomment and configure if using external secret management
#
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: {{ include "orochi-cloud.controlPlane.fullname" . }}-external-secret
#   namespace: {{ include "orochi-cloud.namespace" . }}
#   labels:
#     {{- include "orochi-cloud.controlPlane.labels" . | nindent 4 }}
# spec:
#   refreshInterval: "1h"
#   secretStoreRef:
#     name: vault-backend
#     kind: ClusterSecretStore
#   target:
#     name: {{ include "orochi-cloud.controlPlane.fullname" . }}-secret
#     creationPolicy: Owner
#   data:
#     - secretKey: DATABASE_URL
#       remoteRef:
#         key: orochi-cloud/control-plane
#         property: database_url
#     - secretKey: JWT_SECRET
#       remoteRef:
#         key: orochi-cloud/control-plane
#         property: jwt_secret
#     - secretKey: ENCRYPTION_KEY
#       remoteRef:
#         key: orochi-cloud/control-plane
#         property: encryption_key
{{- end }}
